!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Rainbow=t()}(this,function(){"use strict";function o(){return"undefined"!=typeof module&&"object"==typeof module.exports}function d(e){var t=e.getAttribute("data-language")||e.parentNode.getAttribute("data-language");if(!t){var n=/\blang(?:uage)?-(\w+)/,r=e.className.match(n)||e.parentNode.className.match(n);r&&(t=r[1])}return t?t.toLowerCase():null}function b(e,t,n,r){return(n!==e||r!==t)&&(n<=e&&t<=r)}function s(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&(?![\w\#]+;)/g,"&amp;")}function w(e,t){for(var n=0,r=1;r<t;++r)e[r]&&(n+=e[r].length);return n}function y(e,t,n,r){return e<=n&&n<t||e<r&&r<t}function L(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort(function(e,t){return t-e})}function N(e,t,n,r){var a=r.substr(e);return r.substr(0,e)+a.replace(t,n)}var Prism=function Prism(g){var m,p={},v={};function h(e,t){var n=e.replace(/\./g," "),r=g.globalClass;return r&&(n+=" "+r),'<span class="'+n+'">'+t+"</span>"}function i(s,e,t){void 0===t&&(t=0);var n=s.pattern;if(!n)return!1;var r=!n.global,c=(n=function(e){var t="";return e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),new RegExp(e.source,t)}(n)).exec(e);if(!c)return!1;!s.name&&s.matches&&"string"==typeof s.matches[0]&&(s.name=s.matches[0],delete s.matches[0]);var u=c[0],a=c.index+t,o=c[0].length+a;if(a===o)return!1;if(function(e,t){for(var n in v)if(b(n=parseInt(n,10),v[n],e,t)&&(delete v[n],delete p[n]),y(n,v[n],e,t))return!0;return!1}(a,o))return{remaining:e.substr(o-t),offset:o};function i(r){var e=c[r];if(e){var t=s.matches[r],n=t.language,a=t.name&&t.matches?t.matches:t,o=function(e,t,n){u=N(w(c,r),e,n?h(n,t):t,u)};if("string"!=typeof t){var i=new Prism(g);n?o(e,i.refract(e,n)):o(e,i.refract(e,m,a.length?a:[a]),t.matches?t.name:0)}else o(e,e,t)}}for(var l,f=0,d=L(s.matches);f<d.length;f+=1){i(d[f])}return l=u,s.name&&(l=h(s.name,l)),p[a]={replace:c[0],with:l},v[a]=o,!r&&{remaining:e.substr(o-t),offset:o}}function r(e,t){for(var n=0,r=t;n<r.length;n+=1)for(var a=r[n],o=i(a,e);o;)o=i(a,o.remaining,o.offset);return function(e){for(var t=0,n=L(p);t<n.length;t+=1){var r=n[t],a=p[r];e=N(r,a.replace,a.with,e)}return e}(e)}this.refract=function(e,t,n){return m=t,n=n||function(e){for(var t=g.patterns[e]||[];g.inheritenceMap[e];)e=g.inheritenceMap[e],t=t.concat(g.patterns[e]||[]);return t}(t),r(s(e),n)}};function e(e){var t=e.data,n=new Prism(t.options).refract(t.code,t.lang);function r(){self.postMessage({id:t.id,lang:t.lang,result:n})}if(t.isNode)return r(),void self.close();setTimeout(function(){r()},1e3*t.options.delay)}var a,r={},i={},c={},t={},u=0,l=o(),n="undefined"==typeof document&&"undefined"!=typeof self,f=null;function g(){return!l&&null!==f||(f=function(e,Prism){if(o())return global.Worker=require("webworker-threads").Worker,new Worker(__filename);var t=Prism.toString(),n=L.toString();n+=s.toString(),n+=b.toString(),n+=y.toString(),n+=N.toString(),n+=w.toString();var r=(n+=t)+"\tthis.onmessage="+e.toString(),a=new Blob([r],{type:"text/javascript"});return new Worker((window.URL||window.webkitURL).createObjectURL(a))}(e,Prism)),f}function m(n,r){var a=g();a.addEventListener("message",function e(t){t.data.id===n.id&&(r(t.data),a.removeEventListener("message",e))}),a.postMessage(n)}function p(t,n,r){return function(e){t.innerHTML=e.result,t.classList.remove("loading"),t.classList.add("rainbow-show"),"PRE"===t.parentNode.tagName&&(t.parentNode.classList.remove("loading"),t.parentNode.classList.add("rainbow-show")),a&&a(t,e.lang),0==--n.c&&r()}}function v(e,t){var n={};return"object"==typeof t&&(t=(n=t).language),t=c[t]||t,{id:u++,code:e,lang:t,options:function(e){return{patterns:r,inheritenceMap:i,aliases:c,globalClass:e.globalClass,delay:isNaN(e.delay)?0:e.delay}}(n),isNode:l}}function h(e){var t=document.createElement("div");t.className="preloader";for(var n=0;n<7;n++)t.appendChild(document.createElement("div"));e.appendChild(t)}function E(e,t){t=t||function(){};for(var n=(e=e&&"function"==typeof e.getElementsByTagName?e:document).getElementsByTagName("pre"),r=e.getElementsByTagName("code"),a=[],o=[],i=0,s=n;i<s.length;i+=1){var c=s[i];h(c),c.getElementsByTagName("code").length?c.getAttribute("data-trimmed")||(c.setAttribute("data-trimmed",!0),c.innerHTML=c.innerHTML.trim()):a.push(c)}for(var u=0,l=r;u<l.length;u+=1){var f=l[u];o.push(f)}!function(e,t){for(var n={c:0},r=0,a=e;r<a.length;r+=1){var o=a[r],i=d(o);if(!o.classList.contains("rainbow")&&i){o.classList.add("loading"),o.classList.add("rainbow"),"PRE"===o.parentNode.tagName&&o.parentNode.classList.add("loading");var s=o.getAttribute("data-global-class"),c=parseInt(o.getAttribute("data-delay"),10);++n.c,m(v(o.innerHTML,{language:i,globalClass:s,delay:c}),p(o,n,t))}}0===n.c&&t()}(o.concat(a),t)}return t={extend:function(e,t,n){i[e]||(i[e]=n),r[e]=t.concat(r[e]||[])},remove:function(e){delete i[e],delete r[e]},onHighlight:function(e){a=e},addAlias:function(e,t){c[e]=t},color:function(){for(var t,e=[],n=arguments.length;n--;)e[n]=arguments[n];"string"!=typeof e[0]?"function"!=typeof e[0]?E(e[0],e[1]):E(0,e[0]):m(v(e[0],e[1]),(t=e[2],function(e){t&&t(e.result,e.lang)}))}},l&&(t.colorSync=function(e,t){var n=v(e,t);return new Prism(n.options).refract(n.code,n.lang)}),l||n||document.addEventListener("DOMContentLoaded",function(e){t.defer||t.color(e)},!1),n&&(self.onmessage=e),t});