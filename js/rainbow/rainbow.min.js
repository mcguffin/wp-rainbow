!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Rainbow=t()}(this,function(){"use strict";function e(){return"undefined"!=typeof module&&"object"==typeof module.exports}function t(e){var t=e.getAttribute("data-language")||e.parentNode.getAttribute("data-language");if(!t){var n=/\blang(?:uage)?-(\w+)/,r=e.className.match(n)||e.parentNode.className.match(n);r&&(t=r[1])}return t?t.toLowerCase():null}function n(e,t,n,r){return(n!==e||r!==t)&&(n<=e&&r>=t)}function r(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&(?![\w\#]+;)/g,"&amp;")}function a(e,t){for(var n=0,r=1;r<t;++r)e[r]&&(n+=e[r].length);return n}function o(e,t,n,r){return n>=e&&n<t||r>e&&r<t}function i(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort(function(e,t){return t-e})}function u(e,t,n,r){var a=r.substr(e);return r.substr(0,e)+a.replace(t,n)}function s(t,s){if(e())return global.Worker=require("webworker-threads").Worker,new Worker(__filename);var c=s.toString(),f=i.toString();f+=r.toString(),f+=n.toString(),f+=o.toString(),f+=u.toString(),f+=a.toString(),f+=c;var l=f+"\tthis.onmessage="+t.toString(),d=new Blob([l],{type:"text/javascript"});return new Worker((window.URL||window.webkitURL).createObjectURL(d))}function c(e){function t(){self.postMessage({id:n.id,lang:n.lang,result:a})}var n=e.data,r=new M(n.options),a=r.refract(n.code,n.lang);if(n.isNode)return t(),void self.close();setTimeout(function(){t()},1e3*n.options.delay)}function f(){return(R||null===j)&&(j=s(c,M)),j}function l(e,t){function n(a){a.data.id===e.id&&(t(a.data),r.removeEventListener("message",n))}var r=f();r.addEventListener("message",n),r.postMessage(e)}function d(e,t,n){return function(r){e.innerHTML=r.result,e.classList.remove("loading"),"PRE"===e.parentNode.tagName&&e.parentNode.classList.remove("loading"),E&&E(e,r.lang),0==--t.c&&n()}}function g(e){return{patterns:C,inheritenceMap:S,aliases:T,globalClass:e.globalClass,delay:isNaN(e.delay)?0:e.delay}}function m(e,t){var n={};return"object"==typeof t&&(n=t,t=n.language),t=T[t]||t,{id:A++,code:e,lang:t,options:g(n),isNode:R}}function p(e,n){for(var r={c:0},a=0,o=e;a<o.length;a+=1){var i=o[a],u=t(i);if(!i.classList.contains("rainbow")&&u){i.classList.add("loading"),i.classList.add("rainbow"),"PRE"===i.parentNode.tagName&&i.parentNode.classList.add("loading");var s=i.getAttribute("data-global-class"),c=parseInt(i.getAttribute("data-delay"),10);++r.c,l(m(i.innerHTML,{language:u,globalClass:s,delay:c}),d(i,r,n))}}0===r.c&&n()}function v(e){var t=document.createElement("div");t.className="preloader";for(var n=0;n<7;n++)t.appendChild(document.createElement("div"));e.appendChild(t)}function h(e,t){t=t||function(){},e=e&&"function"==typeof e.getElementsByTagName?e:document;for(var n=e.getElementsByTagName("pre"),r=e.getElementsByTagName("code"),a=[],o=[],i=0,u=n;i<u.length;i+=1){var s=u[i];v(s),s.getElementsByTagName("code").length?s.getAttribute("data-trimmed")||(s.setAttribute("data-trimmed",!0),s.innerHTML=s.innerHTML.trim()):a.push(s)}for(var c=0,f=r;c<f.length;c+=1){var l=f[c];o.push(l)}p(o.concat(a),t)}function b(e){E=e}function y(e,t,n){S[e]||(S[e]=n),C[e]=t.concat(C[e]||[])}function w(e){delete S[e],delete C[e]}function N(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if("string"==typeof e[0]){return void l(m(e[0],e[1]),function(e){return function(t){e&&e(t.result,t.lang)}}(e[2]))}if("function"==typeof e[0])return void h(0,e[0]);h(e[0],e[1])}function L(e,t){T[e]=t}var E,M=function e(t){function s(e,t){for(var r in b)if(r=parseInt(r,10),n(r,b[r],e,t)&&(delete b[r],delete h[r]),o(r,b[r],e,t))return!0;return!1}function c(e,n){var r=e.replace(/\./g," "),a=t.globalClass;return a&&(r+=" "+a),'<span class="'+r+'">'+n+"</span>"}function f(e){for(var t=i(h),n=0,r=t;n<r.length;n+=1){var a=r[n],o=h[a];e=u(a,o.replace,o.with,e)}return e}function l(e){var t="";return e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),new RegExp(e.source,t)}function d(n,r,o){void 0===o&&(o=0);var f=n.pattern;if(!f)return!1;var d=!f.global;f=l(f);var g=f.exec(r);if(!g)return!1;!n.name&&n.matches&&"string"==typeof n.matches[0]&&(n.name=n.matches[0],delete n.matches[0]);var m=g[0],p=g.index+o,y=g[0].length+p;if(p===y)return!1;if(s(p,y))return{remaining:r.substr(y-o),offset:y};for(var w=i(n.matches),N=0,L=w;N<L.length;N+=1){var E=L[N];!function(r){var o=g[r];if(o){var i=n.matches[r],s=i.language,f=i.name&&i.matches?i.matches:i,l=function(e,t,n){m=u(a(g,r),e,n?c(n,t):t,m)};if("string"==typeof i)return void l(o,o,i);var d,p=new e(t);if(s)return d=p.refract(o,s),void l(o,d);d=p.refract(o,v,f.length?f:[f]),l(o,d,i.matches?i.name:0)}}(E)}return function(e){return n.name&&(e=c(n.name,e)),h[p]={replace:g[0],with:e},b[p]=y,!d&&{remaining:r.substr(y-o),offset:y}}(m)}function g(e,t){for(var n=0,r=t;n<r.length;n+=1)for(var a=r[n],o=d(a,e);o;)o=d(a,o.remaining,o.offset);return f(e)}function m(e){for(var n=t.patterns[e]||[];t.inheritenceMap[e];)e=t.inheritenceMap[e],n=n.concat(t.patterns[e]||[]);return n}function p(e,t,n){return v=t,n=n||m(t),g(r(e),n)}var v,h={},b={};this.refract=p},C={},S={},T={},x={},A=0,R=e(),k=function(){return"undefined"==typeof document&&"undefined"!=typeof self}(),j=null;return x={extend:y,remove:w,onHighlight:b,addAlias:L,color:N},R&&(x.colorSync=function(e,t){var n=m(e,t);return new M(n.options).refract(n.code,n.lang)}),R||k||document.addEventListener("DOMContentLoaded",function(e){x.defer||x.color(e)},!1),k&&(self.onmessage=c),x});