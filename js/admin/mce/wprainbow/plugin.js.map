{"version":3,"sources":["plugin.js"],"names":["$","tinymce","PluginManager","add","editor","setLanguageState","parent_node","dom","getParent","selection","getNode","codeSelect","disabled","value","getAttrib","codeControl","setLanguage","lang","pre","$pre","children","first","is","html","setAttrib","setLineNumber","line_number","openControlPanel","lang_value","line_value","line_enabled","windowManager","open","title","wprainbow","l10n","code_properties","body","type","name","size","label","code_language","values","languages","line_numbers","checked","starting_line","onsubmit","e","data","language","console","log","line","enable_line_numbering","Math","abs","isNaN","mce_wprainbow","addButton","text","tooltip","menu_button","classes","onselect","this","onPostRender","on","event","i","contentStyles","push","onclick","jQuery"],"mappings":"CAAA,SAAUA,GACVC,QAAQC,cAAcC,IAAK,YAAc,SAAUC,GAGlD,QAASC,KACR,GAAIC,GAAcF,EAAOG,IAAIC,UAAWJ,EAAOK,UAAUC,UAAW,MAEpEC,GAAWC,UAAYN,GACvBK,EAAWE,MAAMT,EAAOG,IAAIO,UAAWR,EAAa,kBAE5CS,GACPA,EAAYH,UAAYN,GAI1B,QAASU,GAAaC,GACrB,GAAIC,GAAMd,EAAOG,IAAIC,UAAWJ,EAAOK,UAAUC,UAAW,OAC3DS,EAAOnB,EAAEkB,EAGHC,GAAKC,WAAWC,QAAQC,GAAG,SACjCH,EAAKI,KAAM,SAAWJ,EAAKI,OAAS,WAIrCnB,EAAOG,IAAIiB,UACVN,EACA,gBACAD,GAIF,QAASQ,GAAeC,GACvBtB,EAAOG,IAAIiB,UACVpB,EAAOG,IAAIC,UAAWJ,EAAOK,UAAUC,UAAW,OAClD,YACAgB,GAIF,QAASC,KACR,GAAIrB,GAAcF,EAAOG,IAAIC,UAAWJ,EAAOK,UAAUC,UAAW,OACnEkB,EAAaxB,EAAOG,IAAIO,UAAWR,EAAa,iBAChDuB,EAAazB,EAAOG,IAAIO,UAAWR,EAAa,cAAiB,EACjEwB,EAA6B,MAAdD,CAEhBzB,GAAO2B,cAAcC,MACpBC,MAAOC,EAAUC,KAAKC,gBACtBC,OAEGC,KAAM,UACNC,KAAM,WACNC,KAAM,GACNC,MAAOP,EAAUC,KAAKO,cACtBC,OAAQT,EAAUU,UAClB/B,MAAOe,IAGPU,KAAK,WACLC,KAAK,wBACLE,MAAOP,EAAUC,KAAKU,aACtBhC,MAAO,IACPiC,QAAShB,IAGTQ,KAAK,UACLC,KAAK,gBACLE,MAAOP,EAAUC,KAAKY,cACtBlC,MAAOgB,IAGVmB,SAAU,SAASC,GAElBjC,EAAaiC,EAAEC,KAAKC,UACpBC,QAAQC,KAER,IAAIC,IAAQ,CACRL,GAAEC,KAAKK,wBACVD,EAAOE,KAAKC,IAAIR,EAAEC,KAAKH,eAClBW,MAAOJ,KACXA,EAAO,IAGT7B,EAAe6B,MAjFlB,GAAI3C,GAAYI,EAAamB,EAAYyB,aAsFzCvD,GAAOwD,UAAU,aAChBtB,KAAM,UACNuB,KAAM3B,EAAUC,KAAKO,cACrBoB,QAAS5B,EAAUC,KAAKO,cACxBqB,aAAc,EACdC,QAAU,yBACVC,SAAU,SAAShB,GAClBjC,EAAakD,KAAKrD,UAEnB8B,OAAQT,EAAUU,UAClBuB,aAAc,WACbxD,EAAauD,KACb9D,EAAOgE,GAAI,aAAc,SAAUC,GAClChE,KAED,KAAM,GAAIiE,KAAKpC,GAAUU,UAAY,CACpC,GAAI3B,GAAOiB,EAAUU,UAAU0B,GAAGzD,KAC1BI,IACPb,EAAOmE,cAAcC,KAAM,sBAAsBvD,EAAK,wBAAwBiB,EAAUU,UAAU0B,GAAGT,KAAK,WAO9GzD,EAAOwD,UAAU,yBAChBE,QAAS5B,EAAUC,KAAKC,gBACxBqC,QAAS9C,EACTwC,aAAc,WACbpD,EAAcmD,KACd9D,EAAOgE,GAAI,aAAc,SAAUC,GAClChE,YAMDqE","file":"plugin.js","sourcesContent":["(function($){\ntinymce.PluginManager.add( 'wprainbow' , function( editor ){\n\tvar codeSelect, codeControl, wprainbow = mce_wprainbow;\n\t\n\tfunction setLanguageState( ) {\n\t\tvar parent_node = editor.dom.getParent( editor.selection.getNode() ,'PRE');\n\n\t\tcodeSelect.disabled( ! parent_node );\n\t\tcodeSelect.value(editor.dom.getAttrib( parent_node, 'data-language' ));\n\n\t\tif ( !! codeControl ) {\n\t\t\tcodeControl.disabled( ! parent_node );\n\t\t}\n\t}\n\n\tfunction setLanguage( lang ) {\n\t\tvar pre = editor.dom.getParent( editor.selection.getNode(), 'PRE' ),\n\t\t\t$pre = $(pre);\n\n\t\t// wrap in code\n\t\tif ( ! $pre.children().first().is('code') ) {\n\t\t\t$pre.html( '<code>' + $pre.html() + '</code>' );\n\t\t}\n\n\t\t// wrap in code if\n\t\teditor.dom.setAttrib( \n\t\t\tpre,\n\t\t\t'data-language' , \n\t\t\tlang\n\t\t);\n\n\t}\n\tfunction setLineNumber( line_number ) {\n\t\teditor.dom.setAttrib( \n\t\t\teditor.dom.getParent( editor.selection.getNode(), 'PRE' ), \n\t\t\t'data-line' , \n\t\t\tline_number\n\t\t);\n\t}\n\n\tfunction openControlPanel() {\n\t\tvar parent_node = editor.dom.getParent( editor.selection.getNode() ,'PRE'),\n\t\t\tlang_value = editor.dom.getAttrib( parent_node, 'data-language' ),\n\t\t\tline_value = editor.dom.getAttrib( parent_node, 'data-line' ) || 0,\n\t\t\tline_enabled = line_value != \"-1\";\n\n\t\teditor.windowManager.open({\n\t\t\ttitle: wprainbow.l10n.code_properties,\n\t\t\tbody: [\n\t\t\t\t\t{\t\n\t\t\t\t\t\ttype: 'listbox', \n\t\t\t\t\t\tname: 'language', \n\t\t\t\t\t\tsize: 40, \n\t\t\t\t\t\tlabel: wprainbow.l10n.code_language, \n\t\t\t\t\t\tvalues: wprainbow.languages,\n\t\t\t\t\t\tvalue: lang_value \n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'checkbox',\n\t\t\t\t\t\tname:'enable_line_numbering',\n\t\t\t\t\t\tlabel: wprainbow.l10n.line_numbers, \n\t\t\t\t\t\tvalue: \"1\",\n\t\t\t\t\t\tchecked: line_enabled\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'textbox',\n\t\t\t\t\t\tname:'starting_line',\n\t\t\t\t\t\tlabel: wprainbow.l10n.starting_line, \n\t\t\t\t\t\tvalue: line_value\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\tonsubmit: function(e) {\n\t\t\t\t// set language\n\t\t\t\tsetLanguage( e.data.language );\n\t\t\t\tconsole.log();\n\t\t\t\t\n\t\t\t\tvar line = -1;\n\t\t\t\tif (e.data.enable_line_numbering) {\n\t\t\t\t\tline = Math.abs(e.data.starting_line);\n\t\t\t\t\tif ( isNaN( line ) )\n\t\t\t\t\t\tline = 1;\n\t\t\t\t}\n\t\t\t\t// set or del line number\n\t\t\t\tsetLineNumber( line );\n\t\t\t}\n\t\t});\n\t}\n\t\n\teditor.addButton('wprainbow', {\n\t\ttype: 'listbox',\n\t\ttext: wprainbow.l10n.code_language,\n\t\ttooltip: wprainbow.l10n.code_language,\n\t\tmenu_button : true,\n\t\tclasses : 'widget btn fixed-width', \n\t\tonselect: function(e) {\n\t\t\tsetLanguage( this.value() );\n\t\t},\n\t\tvalues: wprainbow.languages,\n\t\tonPostRender: function() {\n\t\t\tcodeSelect = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t\tfor ( var i in wprainbow.languages ) {\n\t\t\t\tvar lang = wprainbow.languages[i].value;\n\t\t\t\tif ( !! lang ) {\n\t\t\t\t\teditor.contentStyles.push( 'pre[data-language=\"'+lang+'\"]:before { content:\"'+wprainbow.languages[i].text+'\" }' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t});\n\n\teditor.addButton('wprainbow_codecontrol', {\n\t\ttooltip: wprainbow.l10n.code_properties,\n\t\tonclick: openControlPanel,\n\t\tonPostRender: function() {\n\t\t\tcodeControl = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t}\n\t});\n\t\n} );\n})(jQuery);"]}