{"version":3,"sources":["plugin.js"],"names":["$","tinymce","PluginManager","add","editor","setLanguageState","pre","_getPreEl","codeSelect","disabled","value","dom","getAttrib","codeControl","getParent","selection","getNode","_getCodeEl","$code","ln","$pre","children","first","is","attr","html","removeAttr","get","setLanguage","lang","code","setAttrib","setLineNumber","line_number","openControlPanel","findByName","container","name","result","items","each","i","item","getWin","currentWin","windowManager","getWindows","win","settings","id","windowId","lang_value","line_value","line_enabled","open","title","wprainbow","l10n","code_properties","body","type","size","label","code_language","values","languages","line_numbers","checked","onclick","e","this","getEl","lang_input","line_input","parseInt","starting_line","onsubmit","data","language","line","enable_line_numbering","Math","abs","isNaN","mce_wprainbow","addButton","text","tooltip","menu_button","classes","onselect","onPostRender","on","event","contentStyles","push","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["(function($){\ntinymce.PluginManager.add( 'wprainbow' , function( editor ){\n\tvar codeSelect, codeControl, wprainbow = mce_wprainbow;\n\t\n\tfunction setLanguageState( ) {\n\n\t\tvar pre = _getPreEl();\n\n\t\tcodeSelect.disabled( ! pre );\n\t\tcodeSelect.value(editor.dom.getAttrib( pre, 'data-language' ));\n\n\t\tif ( !! codeControl ) {\n\t\t\tcodeControl.disabled( ! pre );\n\t\t}\n\t}\n\n\tfunction _getPreEl() {\n\t\treturn editor.dom.getParent( editor.selection.getNode(), 'PRE' );\n\t}\n\tfunction _getCodeEl() {\n\t\tvar $pre = $( _getPreEl() ),\n\t\t\t$code, ln;\n\n\t\t// fix markup\n\t\tif ( ! $pre.children().first().is('code') ) {\n\t\t\tln = $pre.attr( 'data-line' );\n\t\t\t$pre.html( '<code>' + $pre.html() + '</code>' );\n\t\t\t$code = $pre.children().first();\n\n\t\t\tif ( ln ) {\n\t\t\t\t$pre.removeAttr('data-line');\n\t\t\t\t$code.attr( 'data-line', ln );\n\t\t\t} else {\n\t\t\t\t$code.attr( 'data-line', '-1' );\n\t\t\t}\n\t\t}\n\t\treturn $pre.children().get(0);\n\t}\n\tfunction setLanguage( lang ) {\n\t\tvar pre = _getPreEl(),\n\t\t\tcode = _getCodeEl();\n\n\t\tif ( lang === '' && ! $(code).attr('data-line') ) {\n\t\t\t$(pre).html( $(code).html() );\n\t\t}\n\n\t\t// wrap in code if\n\t\teditor.dom.setAttrib( \n\t\t\tpre,\n\t\t\t'data-language' , \n\t\t\tlang\n\t\t);\n\n\t}\n\tfunction setLineNumber( line_number ) {\n\t\teditor.dom.setAttrib( \n\t\t\t_getCodeEl(), \n\t\t\t'data-line' , \n\t\t\tline_number\n\t\t);\n\t}\n\n\tfunction openControlPanel() {\n\t\tvar lang_value = $( _getPreEl() ).attr( 'data-language' ),\n\t\t\tline_value = $( _getCodeEl() ).attr( 'data-line' ) || '1',\n\t\t\tline_enabled = line_value != \"-1\",\n\t\t\twindowId = 'wp_rainbow_code_properties';\n\n\t\tfunction findByName( container, name ) {\n\t\t\tvar result;\n\n\t\t\tif ( ('function' === typeof container.name ) && container.name() == name ) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tif ( 'function' === typeof container.items ) {\n\t\t\t\t$.each( container.items(), function( i, item ) {\n\t\t\t\t\tresult = findByName( item, name );\n\t\t\t\t\tif ( !! result ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tfunction getWin() {\n\t\t\tvar currentWin;\n\t\t\t$.each( editor.windowManager.getWindows(), function(i,win) {\n\t\t\t\tif ( win.settings.id === windowId ) {\n\t\t\t\t\tcurrentWin = win;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn currentWin;\n\t\t}\n\t\teditor.windowManager.open({\n\t\t\tid: windowId,\n\t\t\ttitle: wprainbow.l10n.code_properties,\n\t\t\tbody: [\n\t\t\t\t\t{\t\n\t\t\t\t\t\ttype: 'listbox', \n\t\t\t\t\t\tname: 'language', \n\t\t\t\t\t\tsize: 40, \n\t\t\t\t\t\tlabel: wprainbow.l10n.code_language, \n\t\t\t\t\t\tvalues: wprainbow.languages,\n\t\t\t\t\t\tvalue: lang_value \n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'checkbox',\n\t\t\t\t\t\tname:'enable_line_numbering',\n\t\t\t\t\t\tlabel: wprainbow.l10n.line_numbers, \n\t\t\t\t\t\tvalue: \"1\",\n\t\t\t\t\t\tchecked: line_enabled,\n\t\t\t\t\t\tonclick: function(e){\n\t\t\t\t\t\t\t// checkbox\n\t\t\t\t\t\t\tvar checked = $( this.getEl() ).is('[aria-checked=\"true\"]'),\n\t\t\t\t\t\t\t\tlang_input = findByName( getWin(), 'language' ),\n\t\t\t\t\t\t\t\tline_input = findByName( getWin(), 'starting_line' ); // Ã¶rx!\n\n\t\t\t\t\t\t\tif ( checked ) {\n\t\t\t\t\t\t\t\tif ( -1 === parseInt( line_input.value() ) ) {\n\t\t\t\t\t\t\t\t\tline_input.value(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ( '' === lang_input.value() ) {\n\t\t\t\t\t\t\t\t\tlang_input.value( 'generic' );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'textbox',\n\t\t\t\t\t\tname:'starting_line',\n\t\t\t\t\t\tlabel: wprainbow.l10n.starting_line, \n\t\t\t\t\t\tvalue: line_value\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\tonsubmit: function(e) {\n\t\t\t\t// set language\n\t\t\t\tsetLanguage( e.data.language );\n\t\t\t\t\n\t\t\t\tvar line = -1;\n\t\t\t\tif (e.data.enable_line_numbering) {\n\t\t\t\t\tline = Math.abs(e.data.starting_line);\n\t\t\t\t\tif ( isNaN( line ) ) {\n\t\t\t\t\t\tline = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// set or del line number\n\t\t\t\tsetLineNumber( line );\n\t\t\t}\n\t\t});\n\t}\n\n\teditor.addButton('wprainbow', {\n\t\ttype: 'listbox',\n\t\ttext: wprainbow.l10n.code_language,\n\t\ttooltip: wprainbow.l10n.code_language,\n\t\tmenu_button : true,\n\t\tclasses : 'widget btn fixed-width', \n\t\tonselect: function(e) {\n\t\t\tsetLanguage( this.value() );\n\t\t},\n\t\tvalues: wprainbow.languages,\n\t\tonPostRender: function() {\n\t\t\tcodeSelect = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t\tfor ( var i in wprainbow.languages ) {\n\t\t\t\tvar lang = wprainbow.languages[i].value;\n\t\t\t\tif ( !! lang ) {\n\t\t\t\t\teditor.contentStyles.push( 'pre[data-language=\"'+lang+'\"]:before { content:\"'+wprainbow.languages[i].text+'\" }' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t});\n\n\teditor.addButton('wprainbow_codecontrol', {\n\t\ttooltip: wprainbow.l10n.code_properties,\n\t\tonclick: openControlPanel,\n\t\tonPostRender: function() {\n\t\t\tcodeControl = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t}\n\t});\n\t\n} );\n})(jQuery);"]}