{"version":3,"sources":["plugin.js"],"names":["$","tinymce","PluginManager","add","editor","setLanguageState","pre","_getPreEl","codeSelect","disabled","value","dom","getAttrib","codeControl","node","selection","getNode","is","prevPre","getParent","setLanguage","lang","el","setAttrib","attr","setLineNumber","line_number","openControlPanel","findByName","container","name","result","items","each","i","item","getWin","currentWin","windowManager","getWindows","win","settings","id","windowId","lang_value","line_value","line_enabled","open","title","wprainbow","l10n","code_properties","body","type","size","label","code_language","values","languages","line_numbers","checked","onclick","e","this","getEl","lang_input","line_input","parseInt","starting_line","onsubmit","data","language","line","enable_line_numbering","Math","abs","isNaN","mce_wprainbow","addButton","text","tooltip","menu_button","classes","onselect","onPostRender","on","event","contentStyles","push","c1","c2","content","console","log","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["(function($){\ntinymce.PluginManager.add( 'wprainbow' , function( editor ){\n\tvar codeSelect, codeControl, wprainbow = mce_wprainbow,\n\t\tprevPre = null;\n\t\n\tfunction setLanguageState( ) {\n\n\t\tvar pre = _getPreEl();\n\n\t\tcodeSelect.disabled( ! pre );\n\t\tcodeSelect.value(editor.dom.getAttrib( pre, 'data-language' ));\n\n\t\tif ( !! codeControl ) {\n\t\t\tcodeControl.disabled( ! pre );\n\t\t}\n\t}\n\n\tfunction _getPreEl() {\n\t\tvar node = editor.selection.getNode();\n\n\t\tif ( ! $( node ).is('pre') ) {\n\t\t\tif ( $( node ).is('#mcepastebin') ) {\n\t\t\t\treturn prevPre;\n\t\t\t}\n\t\t\tnode = editor.dom.getParent( node, 'PRE' );\n\t\t}\n\t\tprevPre = node;\n\n\t\treturn node;\n\t}\n\n\tfunction setLanguage( lang ) {\n\t\tvar el = _getPreEl();\n\t\t// wrap in code if\n\t\teditor.dom.setAttrib( \n\t\t\tel,\n\t\t\t'data-language' , \n\t\t\tlang\n\t\t);\n\n\t\t// set no line numbers by default\n\t\tif ( ! $( el ).attr( 'data-line' ) ) {\n\t\t\t$( el ).attr( 'data-line', '-1' )\n\t\t}\n\t}\n\tfunction setLineNumber( line_number ) {\n\t\teditor.dom.setAttrib( \n\t\t\t_getPreEl(), \n\t\t\t'data-line' , \n\t\t\tline_number\n\t\t);\n\t}\n\n\tfunction openControlPanel() {\n\t\tvar el = _getPreEl(),\n\t\t\tlang_value = $( el ).attr( 'data-language' ),\n\t\t\tline_value = $( el ).attr( 'data-line' ) || '1',\n\t\t\tline_enabled = line_value != \"-1\",\n\t\t\twindowId = 'wp_rainbow_code_properties';\n\n\t\tfunction findByName( container, name ) {\n\t\t\tvar result;\n\n\t\t\tif ( ('function' === typeof container.name ) && container.name() == name ) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tif ( 'function' === typeof container.items ) {\n\t\t\t\t$.each( container.items(), function( i, item ) {\n\t\t\t\t\tresult = findByName( item, name );\n\t\t\t\t\tif ( !! result ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tfunction getWin() {\n\t\t\tvar currentWin;\n\t\t\t$.each( editor.windowManager.getWindows(), function(i,win) {\n\t\t\t\tif ( win.settings.id === windowId ) {\n\t\t\t\t\tcurrentWin = win;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn currentWin;\n\t\t}\n\t\teditor.windowManager.open({\n\t\t\tid: windowId,\n\t\t\ttitle: wprainbow.l10n.code_properties,\n\t\t\tbody: [\n\t\t\t\t\t{\t\n\t\t\t\t\t\ttype: 'listbox', \n\t\t\t\t\t\tname: 'language', \n\t\t\t\t\t\tsize: 40, \n\t\t\t\t\t\tlabel: wprainbow.l10n.code_language, \n\t\t\t\t\t\tvalues: wprainbow.languages,\n\t\t\t\t\t\tvalue: lang_value \n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'checkbox',\n\t\t\t\t\t\tname:'enable_line_numbering',\n\t\t\t\t\t\tlabel: wprainbow.l10n.line_numbers, \n\t\t\t\t\t\tvalue: \"1\",\n\t\t\t\t\t\tchecked: line_enabled,\n\t\t\t\t\t\tonclick: function(e){\n\t\t\t\t\t\t\t// checkbox\n\t\t\t\t\t\t\tvar checked = $( this.getEl() ).is('[aria-checked=\"true\"]'),\n\t\t\t\t\t\t\t\tlang_input = findByName( getWin(), 'language' ),\n\t\t\t\t\t\t\t\tline_input = findByName( getWin(), 'starting_line' ); // Ã¶rx!\n\n\t\t\t\t\t\t\tif ( checked ) {\n\t\t\t\t\t\t\t\tif ( -1 === parseInt( line_input.value() ) ) {\n\t\t\t\t\t\t\t\t\tline_input.value(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ( '' === lang_input.value() ) {\n\t\t\t\t\t\t\t\t\tlang_input.value( 'generic' );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'textbox',\n\t\t\t\t\t\tname:'starting_line',\n\t\t\t\t\t\tlabel: wprainbow.l10n.starting_line, \n\t\t\t\t\t\tvalue: line_value\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\tonsubmit: function(e) {\n\t\t\t\t// set language\n\t\t\t\tsetLanguage( e.data.language );\n\t\t\t\t\n\t\t\t\tvar line = -1;\n\t\t\t\tif (e.data.enable_line_numbering) {\n\t\t\t\t\tline = Math.abs(e.data.starting_line);\n\t\t\t\t\tif ( isNaN( line ) ) {\n\t\t\t\t\t\tline = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// set or del line number\n\t\t\t\tsetLineNumber( line );\n\t\t\t}\n\t\t});\n\t}\n\n\teditor.addButton('wprainbow', {\n\t\ttype: 'listbox',\n\t\ttext: wprainbow.l10n.code_language,\n\t\ttooltip: wprainbow.l10n.code_language,\n\t\tmenu_button : true,\n\t\tclasses : 'widget btn fixed-width', \n\t\tonselect: function(e) {\n\t\t\tsetLanguage( this.value() );\n\t\t},\n\t\tvalues: wprainbow.languages,\n\t\tonPostRender: function() {\n\t\t\tcodeSelect = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t\tfor ( var i in wprainbow.languages ) {\n\t\t\t\tvar lang = wprainbow.languages[i].value;\n\t\t\t\tif ( !! lang ) {\n\t\t\t\t\teditor.contentStyles.push( 'pre[data-language=\"'+lang+'\"]:before { content:\"'+wprainbow.languages[i].text+'\" }' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t});\n\n\teditor.addButton('wprainbow_codecontrol', {\n\t\ttooltip: wprainbow.l10n.code_properties,\n\t\tonclick: openControlPanel,\n\t\tonPostRender: function() {\n\t\t\tcodeControl = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t}\n\t});\n\tvar c1,c2;\n\teditor.on( 'PastePreProcess', function(e) {\n\t\tvar el = _getPreEl();\n\n\t\tc1=e.content;\n\t}, true);\n\n\teditor.on( 'PastePreProcess', function(e) {\n\t\tvar el = _getPreEl(),\n\t\t\tpastebin,\n\t\t\tpasted;\n\t\tc2=e.content;\n\t\tconsole.log(c1==c2);\n\t\tconsole.log(e);\n\t});\n} );\n})(jQuery);"]}