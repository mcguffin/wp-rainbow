{"version":3,"sources":["plugin.js"],"names":["$","tinymce","PluginManager","add","editor","setLanguageState","pre","_getPreEl","codeSelect","disabled","value","dom","getAttrib","codeControl","getParent","selection","getNode","setLanguage","lang","el","setAttrib","attr","setLineNumber","line_number","openControlPanel","findByName","container","name","result","items","each","i","item","getWin","currentWin","windowManager","getWindows","win","settings","id","windowId","lang_value","line_value","line_enabled","open","title","wprainbow","l10n","code_properties","body","type","size","label","code_language","values","languages","line_numbers","checked","onclick","e","this","getEl","is","lang_input","line_input","parseInt","starting_line","onsubmit","data","language","line","enable_line_numbering","Math","abs","isNaN","mce_wprainbow","addButton","text","tooltip","menu_button","classes","onselect","onPostRender","on","event","contentStyles","push","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["(function($){\ntinymce.PluginManager.add( 'wprainbow' , function( editor ){\n\tvar codeSelect, codeControl, wprainbow = mce_wprainbow;\n\t\n\tfunction setLanguageState( ) {\n\n\t\tvar pre = _getPreEl();\n\n\t\tcodeSelect.disabled( ! pre );\n\t\tcodeSelect.value(editor.dom.getAttrib( pre, 'data-language' ));\n\n\t\tif ( !! codeControl ) {\n\t\t\tcodeControl.disabled( ! pre );\n\t\t}\n\t}\n\n\tfunction _getPreEl() {\n\t\treturn editor.dom.getParent( editor.selection.getNode(), 'PRE' );\n\t}\n\n\tfunction setLanguage( lang ) {\n\t\tvar el = _getPreEl()\n\t\t// wrap in code if\n\t\teditor.dom.setAttrib( \n\t\t\tel,\n\t\t\t'data-language' , \n\t\t\tlang\n\t\t);\n\n\t\t// set no line numbers by default\n\t\tif ( ! $( el ).attr( 'data-line' ) ) {\n\t\t\t$( el ).attr( 'data-line', '-1' )\n\t\t}\n\t}\n\tfunction setLineNumber( line_number ) {\n\t\teditor.dom.setAttrib( \n\t\t\t_getPreEl(), \n\t\t\t'data-line' , \n\t\t\tline_number\n\t\t);\n\t}\n\n\tfunction openControlPanel() {\n\t\tvar el = _getPreEl(),\n\t\t\tlang_value = $( el ).attr( 'data-language' ),\n\t\t\tline_value = $( el ).attr( 'data-line' ) || '1',\n\t\t\tline_enabled = line_value != \"-1\",\n\t\t\twindowId = 'wp_rainbow_code_properties';\n\n\t\tfunction findByName( container, name ) {\n\t\t\tvar result;\n\n\t\t\tif ( ('function' === typeof container.name ) && container.name() == name ) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tif ( 'function' === typeof container.items ) {\n\t\t\t\t$.each( container.items(), function( i, item ) {\n\t\t\t\t\tresult = findByName( item, name );\n\t\t\t\t\tif ( !! result ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tfunction getWin() {\n\t\t\tvar currentWin;\n\t\t\t$.each( editor.windowManager.getWindows(), function(i,win) {\n\t\t\t\tif ( win.settings.id === windowId ) {\n\t\t\t\t\tcurrentWin = win;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn currentWin;\n\t\t}\n\t\teditor.windowManager.open({\n\t\t\tid: windowId,\n\t\t\ttitle: wprainbow.l10n.code_properties,\n\t\t\tbody: [\n\t\t\t\t\t{\t\n\t\t\t\t\t\ttype: 'listbox', \n\t\t\t\t\t\tname: 'language', \n\t\t\t\t\t\tsize: 40, \n\t\t\t\t\t\tlabel: wprainbow.l10n.code_language, \n\t\t\t\t\t\tvalues: wprainbow.languages,\n\t\t\t\t\t\tvalue: lang_value \n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'checkbox',\n\t\t\t\t\t\tname:'enable_line_numbering',\n\t\t\t\t\t\tlabel: wprainbow.l10n.line_numbers, \n\t\t\t\t\t\tvalue: \"1\",\n\t\t\t\t\t\tchecked: line_enabled,\n\t\t\t\t\t\tonclick: function(e){\n\t\t\t\t\t\t\t// checkbox\n\t\t\t\t\t\t\tvar checked = $( this.getEl() ).is('[aria-checked=\"true\"]'),\n\t\t\t\t\t\t\t\tlang_input = findByName( getWin(), 'language' ),\n\t\t\t\t\t\t\t\tline_input = findByName( getWin(), 'starting_line' ); // Ã¶rx!\n\n\t\t\t\t\t\t\tif ( checked ) {\n\t\t\t\t\t\t\t\tif ( -1 === parseInt( line_input.value() ) ) {\n\t\t\t\t\t\t\t\t\tline_input.value(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ( '' === lang_input.value() ) {\n\t\t\t\t\t\t\t\t\tlang_input.value( 'generic' );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'textbox',\n\t\t\t\t\t\tname:'starting_line',\n\t\t\t\t\t\tlabel: wprainbow.l10n.starting_line, \n\t\t\t\t\t\tvalue: line_value\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\tonsubmit: function(e) {\n\t\t\t\t// set language\n\t\t\t\tsetLanguage( e.data.language );\n\t\t\t\t\n\t\t\t\tvar line = -1;\n\t\t\t\tif (e.data.enable_line_numbering) {\n\t\t\t\t\tline = Math.abs(e.data.starting_line);\n\t\t\t\t\tif ( isNaN( line ) ) {\n\t\t\t\t\t\tline = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// set or del line number\n\t\t\t\tsetLineNumber( line );\n\t\t\t}\n\t\t});\n\t}\n\n\teditor.addButton('wprainbow', {\n\t\ttype: 'listbox',\n\t\ttext: wprainbow.l10n.code_language,\n\t\ttooltip: wprainbow.l10n.code_language,\n\t\tmenu_button : true,\n\t\tclasses : 'widget btn fixed-width', \n\t\tonselect: function(e) {\n\t\t\tsetLanguage( this.value() );\n\t\t},\n\t\tvalues: wprainbow.languages,\n\t\tonPostRender: function() {\n\t\t\tcodeSelect = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t\tfor ( var i in wprainbow.languages ) {\n\t\t\t\tvar lang = wprainbow.languages[i].value;\n\t\t\t\tif ( !! lang ) {\n\t\t\t\t\teditor.contentStyles.push( 'pre[data-language=\"'+lang+'\"]:before { content:\"'+wprainbow.languages[i].text+'\" }' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t});\n\n\teditor.addButton('wprainbow_codecontrol', {\n\t\ttooltip: wprainbow.l10n.code_properties,\n\t\tonclick: openControlPanel,\n\t\tonPostRender: function() {\n\t\t\tcodeControl = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t}\n\t});\n\t\n} );\n})(jQuery);"]}