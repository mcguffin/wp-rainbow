{"version":3,"sources":["plugin.js"],"names":["$","tinymce","PluginManager","add","editor","setLanguageState","pre","_getPreEl","codeSelect","disabled","value","dom","getAttrib","codeControl","getParent","selection","getNode","_getCodeEl","$code","ln","$pre","children","first","is","attr","html","removeAttr","get","setLanguage","lang","code","setAttrib","setLineNumber","line_number","openControlPanel","lang_value","line_value","line_enabled","windowManager","open","title","wprainbow","l10n","code_properties","body","type","name","size","label","code_language","values","languages","line_numbers","checked","starting_line","onsubmit","e","data","language","line","enable_line_numbering","Math","abs","isNaN","mce_wprainbow","addButton","text","tooltip","menu_button","classes","onselect","this","onPostRender","on","event","i","contentStyles","push","onclick","jQuery"],"mappings":"CAAA,SAAUA,GACVC,QAAQC,cAAcC,IAAK,YAAc,SAAUC,GAGlD,QAASC,KAER,GAAIC,GAAMC,GAEVC,GAAWC,UAAYH,GACvBE,EAAWE,MAAMN,EAAOO,IAAIC,UAAWN,EAAK,kBAEpCO,GACPA,EAAYJ,UAAYH,GAI1B,QAASC,KACR,MAAOH,GAAOO,IAAIG,UAAWV,EAAOW,UAAUC,UAAW,OAE1D,QAASC,KACR,GACCC,GAAOC,EADJC,EAAOpB,EAAGO,IAgBd,OAZOa,GAAKC,WAAWC,QAAQC,GAAG,UACjCJ,EAAKC,EAAKI,KAAM,aAChBJ,EAAKK,KAAM,SAAWL,EAAKK,OAAS,WACpCP,EAAQE,EAAKC,WAAWC,QAEnBH,GACJC,EAAKM,WAAW,aAChBR,EAAMM,KAAM,YAAaL,IAEzBD,EAAMM,KAAM,YAAa,OAGpBJ,EAAKC,WAAWM,IAAI,GAE5B,QAASC,GAAaC,GACrB,GAAIvB,GAAMC,IACTuB,EAAOb,GAEM,MAATY,GAAiB7B,EAAE8B,GAAMN,KAAK,cAClCxB,EAAEM,GAAKmB,KAAMzB,EAAE8B,GAAML,QAItBrB,EAAOO,IAAIoB,UACVzB,EACA,gBACAuB,GAIF,QAASG,GAAeC,GACvB7B,EAAOO,IAAIoB,UACVd,IACA,YACAgB,GAIF,QAASC,KACR,GAAIC,GAAanC,EAAGO,KAAciB,KAAM,iBACvCY,EAAapC,EAAGiB,KAAeO,KAAM,cAAiB,IACtDa,EAA6B,MAAdD,CAEhBhC,GAAOkC,cAAcC,MACpBC,MAAOC,EAAUC,KAAKC,gBACtBC,OAEGC,KAAM,UACNC,KAAM,WACNC,KAAM,GACNC,MAAOP,EAAUC,KAAKO,cACtBC,OAAQT,EAAUU,UAClBzC,MAAOyB,IAGPU,KAAK,WACLC,KAAK,wBACLE,MAAOP,EAAUC,KAAKU,aACtB1C,MAAO,IACP2C,QAAShB,IAGTQ,KAAK,UACLC,KAAK,gBACLE,MAAOP,EAAUC,KAAKY,cACtB5C,MAAO0B,IAGVmB,SAAU,SAASC,GAElB5B,EAAa4B,EAAEC,KAAKC,SAEpB,IAAIC,IAAQ,CACRH,GAAEC,KAAKG,wBACVD,EAAOE,KAAKC,IAAIN,EAAEC,KAAKH,eAClBS,MAAOJ,KACXA,EAAO,IAGT3B,EAAe2B,MArGlB,GAAInD,GAAYK,EAAa4B,EAAYuB,aA0GzC5D,GAAO6D,UAAU,aAChBpB,KAAM,UACNqB,KAAMzB,EAAUC,KAAKO,cACrBkB,QAAS1B,EAAUC,KAAKO,cACxBmB,aAAc,EACdC,QAAU,yBACVC,SAAU,SAASd,GAClB5B,EAAa2C,KAAK7D,UAEnBwC,OAAQT,EAAUU,UAClBqB,aAAc,WACbhE,EAAa+D,KACbnE,EAAOqE,GAAI,aAAc,SAAUC,GAClCrE,KAED,KAAM,GAAIsE,KAAKlC,GAAUU,UAAY,CACpC,GAAItB,GAAOY,EAAUU,UAAUwB,GAAGjE,KAC1BmB,IACPzB,EAAOwE,cAAcC,KAAM,sBAAsBhD,EAAK,wBAAwBY,EAAUU,UAAUwB,GAAGT,KAAK,WAO9G9D,EAAO6D,UAAU,yBAChBE,QAAS1B,EAAUC,KAAKC,gBACxBmC,QAAS5C,EACTsC,aAAc,WACb3D,EAAc0D,KACdnE,EAAOqE,GAAI,aAAc,SAAUC,GAClCrE,YAMD0E","file":"plugin.js","sourcesContent":["(function($){\ntinymce.PluginManager.add( 'wprainbow' , function( editor ){\n\tvar codeSelect, codeControl, wprainbow = mce_wprainbow;\n\t\n\tfunction setLanguageState( ) {\n\n\t\tvar pre = _getPreEl();\n\n\t\tcodeSelect.disabled( ! pre );\n\t\tcodeSelect.value(editor.dom.getAttrib( pre, 'data-language' ));\n\n\t\tif ( !! codeControl ) {\n\t\t\tcodeControl.disabled( ! pre );\n\t\t}\n\t}\n\n\tfunction _getPreEl() {\n\t\treturn editor.dom.getParent( editor.selection.getNode(), 'PRE' );\n\t}\n\tfunction _getCodeEl() {\n\t\tvar $pre = $( _getPreEl() ),\n\t\t\t$code, ln;\n\n\t\t// fix markup\n\t\tif ( ! $pre.children().first().is('code') ) {\n\t\t\tln = $pre.attr( 'data-line' );\n\t\t\t$pre.html( '<code>' + $pre.html() + '</code>' );\n\t\t\t$code = $pre.children().first();\n\n\t\t\tif ( ln ) {\n\t\t\t\t$pre.removeAttr('data-line');\n\t\t\t\t$code.attr( 'data-line', ln );\n\t\t\t} else {\n\t\t\t\t$code.attr( 'data-line', '-1' );\n\t\t\t}\n\t\t}\n\t\treturn $pre.children().get(0);\n\t}\n\tfunction setLanguage( lang ) {\n\t\tvar pre = _getPreEl(),\n\t\t\tcode = _getCodeEl();\n\n\t\tif ( lang === '' && ! $(code).attr('data-line') ) {\n\t\t\t$(pre).html( $(code).html() );\n\t\t}\n\n\t\t// wrap in code if\n\t\teditor.dom.setAttrib( \n\t\t\tpre,\n\t\t\t'data-language' , \n\t\t\tlang\n\t\t);\n\n\t}\n\tfunction setLineNumber( line_number ) {\n\t\teditor.dom.setAttrib( \n\t\t\t_getCodeEl(), \n\t\t\t'data-line' , \n\t\t\tline_number\n\t\t);\n\t}\n\n\tfunction openControlPanel() {\n\t\tvar lang_value = $( _getPreEl() ).attr( 'data-language' ),\n\t\t\tline_value = $( _getCodeEl() ).attr( 'data-line' ) || '1',\n\t\t\tline_enabled = line_value != \"-1\";\n\n\t\teditor.windowManager.open({\n\t\t\ttitle: wprainbow.l10n.code_properties,\n\t\t\tbody: [\n\t\t\t\t\t{\t\n\t\t\t\t\t\ttype: 'listbox', \n\t\t\t\t\t\tname: 'language', \n\t\t\t\t\t\tsize: 40, \n\t\t\t\t\t\tlabel: wprainbow.l10n.code_language, \n\t\t\t\t\t\tvalues: wprainbow.languages,\n\t\t\t\t\t\tvalue: lang_value \n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'checkbox',\n\t\t\t\t\t\tname:'enable_line_numbering',\n\t\t\t\t\t\tlabel: wprainbow.l10n.line_numbers, \n\t\t\t\t\t\tvalue: \"1\",\n\t\t\t\t\t\tchecked: line_enabled\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'textbox',\n\t\t\t\t\t\tname:'starting_line',\n\t\t\t\t\t\tlabel: wprainbow.l10n.starting_line, \n\t\t\t\t\t\tvalue: line_value\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\tonsubmit: function(e) {\n\t\t\t\t// set language\n\t\t\t\tsetLanguage( e.data.language );\n\t\t\t\t\n\t\t\t\tvar line = -1;\n\t\t\t\tif (e.data.enable_line_numbering) {\n\t\t\t\t\tline = Math.abs(e.data.starting_line);\n\t\t\t\t\tif ( isNaN( line ) )\n\t\t\t\t\t\tline = 1;\n\t\t\t\t}\n\t\t\t\t// set or del line number\n\t\t\t\tsetLineNumber( line );\n\t\t\t}\n\t\t});\n\t}\n\n\teditor.addButton('wprainbow', {\n\t\ttype: 'listbox',\n\t\ttext: wprainbow.l10n.code_language,\n\t\ttooltip: wprainbow.l10n.code_language,\n\t\tmenu_button : true,\n\t\tclasses : 'widget btn fixed-width', \n\t\tonselect: function(e) {\n\t\t\tsetLanguage( this.value() );\n\t\t},\n\t\tvalues: wprainbow.languages,\n\t\tonPostRender: function() {\n\t\t\tcodeSelect = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t\tfor ( var i in wprainbow.languages ) {\n\t\t\t\tvar lang = wprainbow.languages[i].value;\n\t\t\t\tif ( !! lang ) {\n\t\t\t\t\teditor.contentStyles.push( 'pre[data-language=\"'+lang+'\"]:before { content:\"'+wprainbow.languages[i].text+'\" }' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t});\n\n\teditor.addButton('wprainbow_codecontrol', {\n\t\ttooltip: wprainbow.l10n.code_properties,\n\t\tonclick: openControlPanel,\n\t\tonPostRender: function() {\n\t\t\tcodeControl = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t}\n\t});\n\t\n} );\n})(jQuery);"]}