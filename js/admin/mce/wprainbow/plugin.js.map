{"version":3,"sources":["plugin.js"],"names":["$","tinymce","PluginManager","add","editor","codeSelect","codeControl","wprainbow","mce_wprainbow","setLanguageState","pre","_getPreEl","disabled","value","dom","getAttrib","getParent","selection","getNode","setLanguage","lang","el","setAttrib","attr","addButton","type","text","l10n","code_language","tooltip","menu_button","classes","onselect","e","this","values","languages","onPostRender","i","on","event","contentStyles","push","code_properties","onclick","lang_value","line_value","line_enabled","windowId","findByName","container","name","result","items","each","item","getWin","currentWin","windowManager","getWindows","win","settings","id","open","title","body","size","label","line_numbers","checked","getEl","is","lang_input","line_input","parseInt","starting_line","onsubmit","data","language","line","enable_line_numbering","Math","abs","isNaN","line_number","setLineNumber","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["(function($){\ntinymce.PluginManager.add( 'wprainbow' , function( editor ){\n\tvar codeSelect, codeControl, wprainbow = mce_wprainbow;\n\t\n\tfunction setLanguageState( ) {\n\n\t\tvar pre = _getPreEl();\n\n\t\tcodeSelect.disabled( ! pre );\n\t\tcodeSelect.value(editor.dom.getAttrib( pre, 'data-language' ));\n\n\t\tif ( !! codeControl ) {\n\t\t\tcodeControl.disabled( ! pre );\n\t\t}\n\t}\n\n\tfunction _getPreEl() {\n\t\treturn editor.dom.getParent( editor.selection.getNode(), 'PRE' );\n\t}\n\n\tfunction setLanguage( lang ) {\n\t\tvar el = _getPreEl()\n\t\t// wrap in code if\n\t\teditor.dom.setAttrib( \n\t\t\tel,\n\t\t\t'data-language' , \n\t\t\tlang\n\t\t);\n\n\t\t// set no line numbers by default\n\t\tif ( ! $( el ).attr( 'data-line' ) ) {\n\t\t\t$( el ).attr( 'data-line', '-1' )\n\t\t}\n\t}\n\tfunction setLineNumber( line_number ) {\n\t\teditor.dom.setAttrib( \n\t\t\t_getPreEl(), \n\t\t\t'data-line' , \n\t\t\tline_number\n\t\t);\n\t}\n\n\tfunction openControlPanel() {\n\t\tvar el = _getPreEl(),\n\t\t\tlang_value = $( el ).attr( 'data-language' ),\n\t\t\tline_value = $( el ).attr( 'data-line' ) || '1',\n\t\t\tline_enabled = line_value != \"-1\",\n\t\t\twindowId = 'wp_rainbow_code_properties';\n\n\t\tfunction findByName( container, name ) {\n\t\t\tvar result;\n\n\t\t\tif ( ('function' === typeof container.name ) && container.name() == name ) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tif ( 'function' === typeof container.items ) {\n\t\t\t\t$.each( container.items(), function( i, item ) {\n\t\t\t\t\tresult = findByName( item, name );\n\t\t\t\t\tif ( !! result ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tfunction getWin() {\n\t\t\tvar currentWin;\n\t\t\t$.each( editor.windowManager.getWindows(), function(i,win) {\n\t\t\t\tif ( win.settings.id === windowId ) {\n\t\t\t\t\tcurrentWin = win;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn currentWin;\n\t\t}\n\t\teditor.windowManager.open({\n\t\t\tid: windowId,\n\t\t\ttitle: wprainbow.l10n.code_properties,\n\t\t\tbody: [\n\t\t\t\t\t{\t\n\t\t\t\t\t\ttype: 'listbox', \n\t\t\t\t\t\tname: 'language', \n\t\t\t\t\t\tsize: 40, \n\t\t\t\t\t\tlabel: wprainbow.l10n.code_language, \n\t\t\t\t\t\tvalues: wprainbow.languages,\n\t\t\t\t\t\tvalue: lang_value \n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'checkbox',\n\t\t\t\t\t\tname:'enable_line_numbering',\n\t\t\t\t\t\tlabel: wprainbow.l10n.line_numbers, \n\t\t\t\t\t\tvalue: \"1\",\n\t\t\t\t\t\tchecked: line_enabled,\n\t\t\t\t\t\tonclick: function(e){\n\t\t\t\t\t\t\t// checkbox\n\t\t\t\t\t\t\tvar checked = $( this.getEl() ).is('[aria-checked=\"true\"]'),\n\t\t\t\t\t\t\t\tlang_input = findByName( getWin(), 'language' ),\n\t\t\t\t\t\t\t\tline_input = findByName( getWin(), 'starting_line' ); // Ã¶rx!\n\n\t\t\t\t\t\t\tif ( checked ) {\n\t\t\t\t\t\t\t\tif ( -1 === parseInt( line_input.value() ) ) {\n\t\t\t\t\t\t\t\t\tline_input.value(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ( '' === lang_input.value() ) {\n\t\t\t\t\t\t\t\t\tlang_input.value( 'generic' );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype:'textbox',\n\t\t\t\t\t\tname:'starting_line',\n\t\t\t\t\t\tlabel: wprainbow.l10n.starting_line, \n\t\t\t\t\t\tvalue: line_value\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\tonsubmit: function(e) {\n\t\t\t\t// set language\n\t\t\t\tsetLanguage( e.data.language );\n\t\t\t\t\n\t\t\t\tvar line = -1;\n\t\t\t\tif (e.data.enable_line_numbering) {\n\t\t\t\t\tline = Math.abs(e.data.starting_line);\n\t\t\t\t\tif ( isNaN( line ) ) {\n\t\t\t\t\t\tline = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// set or del line number\n\t\t\t\tsetLineNumber( line );\n\t\t\t}\n\t\t});\n\t}\n\n\teditor.addButton('wprainbow', {\n\t\ttype: 'listbox',\n\t\ttext: wprainbow.l10n.code_language,\n\t\ttooltip: wprainbow.l10n.code_language,\n\t\tmenu_button : true,\n\t\tclasses : 'widget btn fixed-width', \n\t\tonselect: function(e) {\n\t\t\tsetLanguage( this.value() );\n\t\t},\n\t\tvalues: wprainbow.languages,\n\t\tonPostRender: function() {\n\t\t\tcodeSelect = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t\tfor ( var i in wprainbow.languages ) {\n\t\t\t\tvar lang = wprainbow.languages[i].value;\n\t\t\t\tif ( !! lang ) {\n\t\t\t\t\teditor.contentStyles.push( 'pre[data-language=\"'+lang+'\"]:before { content:\"'+wprainbow.languages[i].text+'\" }' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t});\n\n\teditor.addButton('wprainbow_codecontrol', {\n\t\ttooltip: wprainbow.l10n.code_properties,\n\t\tonclick: openControlPanel,\n\t\tonPostRender: function() {\n\t\t\tcodeControl = this;\n\t\t\teditor.on( 'nodechange', function( event ) {\n\t\t\t\tsetLanguageState( );\n\t\t\t});\n\t\t}\n\t});\n\t\n} );\n})(jQuery);"]}